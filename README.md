# Code for: Janzen–Connell effects and habitat-induced aggregation synergistically promote species coexistence

**Author:** Daniel J. B. Smith  
**Contact:** smithdj4@utexas.edu  

This repository contains the simulation and visualization code associated with the paper:

**Smith, D.J.B. (2025).** *Janzen–Connell effects and habitat-induced aggregation synergistically promote species coexistence.*

---

## Introduction

This repository contains all code used to run simulations and generate figures for the paper.  

- **Julia project (`HP_JCE_Sims/`)**  
  Implements spatially explicit simulations of Janzen–Connell effects, habitat partitioning, and dispersal limitation.  
  - `src/` defines the core functions and modules.  
  - `run/` contains driver scripts for reproducing the simulation outputs used in each figure.  
  - `Outputs/` stores the `.csv` files written by the simulations.  

- **R scripts (`Code_For_Figures/`)**  
  Read simulation outputs and generate the figures shown in the paper and supplementary information.  
  - Main figure scripts (Figures 2–6).  
  - Supplementary figure scripts.  
  - `Visualization_Scripts/` contains additional plotting utilities.  

- **Figures/**  
  All final plots generated by the R scripts are saved here in `.svg` and `.png` format.  

Together, these scripts allow you to:  
1. Run the Julia simulations to regenerate raw data.  
2. Use the R scripts to reproduce each figure directly from the outputs.  

---

## Software Versions + Details

```text
Julia: 1.11
R: 4.3.2
OS tested: Windows 11
```
All simulations in VSCode. Simulations were run on a desktop PC with 20 threads. The code will use as many threads are permitted in your VSCode settings.  

---

## Julia Simulations (`HP_JCE_Sims/`)

A complete Julia project with pinned dependencies via `Project.toml` and `Manifest.toml`.

### Setup (one-time)

```julia
using Pkg
Pkg.activate(".")    # activate this project
Pkg.instantiate()    # install exact dependencies from Manifest.toml
```

### Example run (Figure 2G)

```julia
using Pkg
Pkg.activate(".")     
cd("Hab_Par_New/HP_JCE_Sims")
include("run/Figure_Regional_Pool_Size.jl")
```

Other figure panels have analogous scripts in the `run/` folder.

### Source files (`HP_JCE_Sims/src/`)

```text
Environment.jl             — habitat generation & spatial autocorrelation
Helpers.jl                 — I/O, utilities, seeding helpers
HP_JCE_Sims.jl             — project entry/exports (if used)
Messing_around.jl          — sandbox/testing (kept for future edits)
Parameters.jl              — parameter structs & defaults
Simulation.jl              — main single-run simulation workflow
Simulation_backup_Newer.jl — preserved backup of a simulation workflow
SpeciesUtils.jl            — species-level utilities/bookkeeping
Competition.jl             — local competition & JC-effect implementation
Dispersal.jl               — dispersal kernels & propagule movement
```

Functions are described within the scripts themselves.

### Run scripts (`HP_JCE_Sims/run/`)

```text
Figure_Regional_Pool_Size.jl       — runs simulations for Figure 2G
Fig_3A_Moore_Sigma_Low_AutoCor_No_Disp_Lim.lj  — runs simulations for Figure 3A
```

Simulation outputs are written to subfolders of:

```text
HP_JCE_Sims/Outputs/
```

---

## R Visualization (`Code_For_Figures/`)

All figure scripts read simulation `.csv` files from `HP_JCE_Sims/Outputs/...` and save `.svg`/`.png` into the top-level `Figures/` folder.  
Scripts use portable, project-relative paths.

### Install required R packages (one-time)

```r
install.packages(c(
  "tidyverse",  # brings in readr, dplyr, tidyr, purrr, ggplot2
  "ggplot2",
  "dplyr",
  "viridis",
  "patchwork",
  "grid",
  "scales",
  "readr",
  "purrr",
  "tidyr"
))
```

### Main R scripts (figures)

```text
Code_For_Figures/Figure_2_Regional_Pool_Size.R
Code_For_Figures/Figure_3_Heatmaps.R
Code_For_Figures/Figure_4_heatmaps_scatter.R
Code_For_Figures/Figure_5_Make_Plot.R
Code_For_Figures/Figure_6_Make_Plot.R
Code_For_Figures/Figure_2_Analytical_Results_Current_Version.R
```

### Supplementary Information (R)

```text
Code_For_Figures/SI_Figure_Heatmaps_Tol_Fec.R
Code_For_Figures/SI_Figure_Cov_scatter_avar.R
Code_For_Figures/SI_FIgure_Cov_scatter_Tol_Fec.R
```

### Visualization utilities

```text
Code_For_Figures/Visualization_Scripts/
```

Contains helper plotting code.  
*(Not fully streamlined; may require light edits before use.)*

---

## Reproducing Figures (end-to-end)

### 1. Run Julia simulations

```julia
using Pkg
Pkg.activate("."); Pkg.instantiate()
include("run/<desired_script>.jl")
```

Outputs will appear in:

```text
HP_JCE_Sims/Outputs/...
```

### 2. Generate figures in R

Open the corresponding script in:

```text
Code_For_Figures/
```

Run it to save figures into:

```text
Figures/
```

---


